{"version":3,"sources":["types.ts","core/bundler.ts","utils/index.ts","cli/logger.ts","utils/installPackage.ts","utils/getModuleParts.ts","utils/localRequire.ts","targets/chrome.ts","core/target-runtime-provider.ts","core/utils.ts","core/analyze.ts","core/test.ts","core/post-analyze.ts","core/server.ts","core/index.ts","test/error.ts","test/test.ts","test/assert.ts","test/index.ts","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/bundle-loader.js","index.ts"],"names":["FileType","NODE_GLOBAL","TARGET","BROWSER_TARGET","BUNDLER_TARGET","CHROME_EXTENSION","CHROME_CANARY","CHROME_CANARY_EXTENSION","FIREFOX","FIREFOX_EXTENSION","FIREFOX_NIGHTLY","FIREFOX_NIGHTLY_EXTENSION","targetToBundlerTarget","target","BROWSER","NODE","ELECTRON","MESSAGE_TYPE","options","Observable","create","observer","bundler","ParcelBundler","entryFiles","_","addAssetType","Path","resolve","__dirname","on","bundle","next","name","buildEndTime","Date","now","buildStartTime","error","stop","refCount","prettifyPath","_path","path","relative","process","cwd","getEmptyPageUrl","port","transformPathToEpkUrl","transformPathToTestUrl","replace","prettyError","err","color","undefined","message","stack","fileName","loc","line","column","codeFrame","highlightedCodeFrame","slice","indexOf","supportsEmoji","platform","env","TERM","defaultEmojis","progress","success","warning","countLines","str","split","reduce","p","stdout","columns","Math","ceil","length","pad","text","align","repeat","stringWidth","stripAnsi","countBreaks","Logger","logLevel","Chalk","supportsColor","emojis","chalk","constructor","enabled","isTest","NODE_ENV","lines","spinner","logFile","writeRaw","write","persistent","verbose","stopSpinner","_log","currDate","toLocaleTimeString","fs","createWriteStream","join","toISOString","log","formatError","_writeError","emoji","_color","console","logger","bold","warn","yellow","red","green","clear","clearLine","moveCursor","cursorTo","styledMessage","gray","stream","start","table","colWidths","row","i","item","max","map","padding","handleMessage","method","args","promisify","utils","_resolve","YARN_LOCK","install","modules","filepath","installPeers","saveDev","packageManager","packageLocation","config","dirname","determinePackageManager","commandToUse","push","writeFile","Error","Promise","all","m","installPeerDependencies","basedir","resolved","peers","load","peerDependencies","peer","Object","assign","checkForYarnCommand","hasYarn","queue","PromiseQueue","maxConcurrent","retry","WorkerFarm","isWorker","add","run","callMaster","location","__filename","parts","normalize","sep","charAt","splice","Resolve","cache","Map","localRequire","triedInstall","require","key","get","e","code","packageName","set","packages","includes","pkg","pptr","closed","browser","then","launch","devtools","page","newPage","emptyHTMLFilePath","url","loadFile","file","goto","addScriptTag","exec","evaluate","close","targetRuntimes","CHROME","ChromeRuntime","targetRuntimeProvider","targetRuntime","stringify","strings","vals","finalStr","JSON","prettifyTime","time","toFixed","isBrowser","window","browserStr","data","GET_TESTS_RESPONSE","nodeStr","analyzeStr","tests","errors","type","GET_TESTS","ANALYZE","RUN_TEST_RESPONSE","testStr","test","result","RUN_TEST","description","TEST","readFile","makeStackLocation","originalColumn","originalLine","source","makeStackLines","metaLine","originalName","makeStack","metaStack","files","sourceMapConsumers","has","content","encoding","childBundle","childBundles","sourceMapPath","sourceMap","parse","sourceMapConsumer","SourceMap","SourceMapConsumer","errorsWithMetadata","stackTraceParser","string","lineNumber","methodName","originalPositionFor","testError","originalStack","POST_ANALYZE","imports","val","app","Koa","serve","mount","epk","use","listen","_options","keys","forEach","browsers","outDir","watch","cacheDir","minify","scopeHoist","sourceMaps","detailedReport","throwErrors","hmr","_port","getPort","targetRuntimeProviders","bundleContainer","isEmpty","Array","from","newContextObservable","entryAsset","analyzedObservable","testedObservable","postAnalyzeObservable","testerObservable","connect","addEventListener","todo","pass","fail","desc","func","initiated","setTimeout","emit","parent","postMessage","global","getTests","body","toString","runTest","performance","timeStart","timeEnd","value","newEvent","EventEmitter","addListener","assert","PowerAssert","customize","bundleURL","getBundleURLCached","getBundleURL","matches","match","getBaseURL","exports","loadBundlesLazy","bundles","isArray","id","LazyPromise","reject","loadBundles","loadBundle","bundleLoaders","registerBundleLoader","loader","module","register","substring","lastIndexOf","toLowerCase","bundleLoader","catch","executor","promise","prototype","onSuccess","onError"],"mappings":"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","file":"index.map","sourceRoot":"..\\src","sourcesContent":["import { Observable } from 'rxjs'\r\n\r\nexport const NODE_GLOBAL = '__EPK_NODE_GLOBAL'\r\n\r\n/**\r\n * List of different runtimes (available) to test on\r\n */\r\nexport enum TARGET {\r\n  NODE = 'node',\r\n  ELECTRON = 'electron',\r\n  DENO = 'deno',\r\n  CHROME = 'chrome',\r\n  CHROME_EXTENSION = 'chromeExtension',\r\n  CHROME_CANARY = 'chromeCanary',\r\n  CHROME_CANARY_EXTENSION = 'chromeCanaryExtension',\r\n  FIREFOX = 'firefox',\r\n  FIREFOX_EXTENSION = 'firefoxExtension',\r\n  FIREFOX_NIGHTLY = 'firefoxNightly',\r\n  FIREFOX_NIGHTLY_EXTENSION = 'firefoxNightlyExtension'\r\n}\r\n\r\nexport enum BROWSER_TARGET {\r\n  CHROME = TARGET.CHROME_EXTENSION,\r\n  CHROME_EXTENSION = TARGET.CHROME_CANARY,\r\n  CHROME_CANARY = TARGET.CHROME_CANARY_EXTENSION,\r\n  CHROME_CANARY_EXTENSION = TARGET.FIREFOX,\r\n  FIREFOX = TARGET.FIREFOX_EXTENSION,\r\n  FIREFOX_EXTENSION = TARGET.FIREFOX_NIGHTLY,\r\n  FIREFOX_NIGHTLY = TARGET.FIREFOX_NIGHTLY_EXTENSION,\r\n  FIREFOX_NIGHTLY_EXTENSION = TARGET.FIREFOX_NIGHTLY_EXTENSION\r\n}\r\n\r\nexport enum BUNDLER_TARGET {\r\n  NODE = 'node',\r\n  BROWSER = 'browser',\r\n  ELECTRON = 'electron'\r\n}\r\n\r\nexport const targetToBundlerTarget =\r\n  (target: TARGET): BUNDLER_TARGET =>\r\n    target in BROWSER_TARGET ? BUNDLER_TARGET.BROWSER\r\n    : target as unknown as BUNDLER_TARGET === BUNDLER_TARGET.NODE ? BUNDLER_TARGET.NODE\r\n    : target as unknown as BUNDLER_TARGET === BUNDLER_TARGET.ELECTRON && BUNDLER_TARGET.NODE\r\n\r\nexport interface Bundler extends Observable<any> {}\r\n\r\nexport interface TargetRuntime extends Observable<any> {\r\n  loadFile: Function\r\n  exec: Function\r\n}\r\nexport interface TargetRuntimeObservable extends Observable<TargetRuntime> {\r\n  target: TARGET\r\n  options: TargetRuntimeOptions\r\n}\r\n\r\nexport interface TargetRuntimeOptions {}\r\nexport interface TargetRuntimeProvider extends Observable<TargetRuntimeObservable> {\r\n  target: TARGET\r\n  options: TargetRuntimeOptions\r\n}\r\nexport interface TargetRuntimeProviderOptions {}\r\n\r\nexport enum MESSAGE_TYPE {\r\n  GET_TESTS = '__EPK_GET_TESTS',\r\n  RUN_TESTS = '__EPK_RUN_TESTS',\r\n  RUN_TEST = '__EPK_RUN_TEST',\r\n  GET_TESTS_RESPONSE = '__EPK_GET_TESTS_RESPONSE',\r\n  RUN_TESTS_RESPONSE = '__EPK_RUN_TESTS_RESPONSE',\r\n  RUN_TEST_RESPONSE = '__EPK_RUN_TEST_RESPONSE'\r\n}\r\n\r\nexport interface Message {\r\n  type: MESSAGE_TYPE,\r\n  payload: any\r\n}\r\n\r\nexport interface Options {\r\n  browsers?: BROWSER_TARGET[]\r\n  entryFiles: string[]\r\n  target: BUNDLER_TARGET\r\n  watch?: Boolean\r\n  outDir?: string\r\n  cache?: Boolean\r\n  cacheDir?: string\r\n  minify?: Boolean\r\n  scopeHoist?: Boolean\r\n  /**\r\n   * 0 = log nothing\r\n   * 1 = log errors\r\n   * 2 = log warnings & errors\r\n   * 3 = log everything\r\n   */\r\n  logLevel?: 0 | 1 | 2 | 3\r\n  sourceMaps?: Boolean\r\n  detailedReport?: Boolean\r\n}\r\n\r\nexport interface Target {\r\n  type: TARGET\r\n  test: Function\r\n  prepare: Function\r\n}\r\n\r\n/**\r\n * Context object of the testing pipeline that contains all the information needed for each testing steps\r\n */\r\nexport interface Context {\r\n  /**\r\n   * Options passed to epk\r\n   */\r\n  options: Options\r\n  /**\r\n   * Files found by the paths/globs\r\n   */\r\n  files: File[]\r\n  /**\r\n   * entryFiles from Parcel\r\n   */\r\n  entryFiles: string[]\r\n  /**\r\n   * Array of targets in which the tests will be executed\r\n   */\r\n  targets: TARGET[]\r\n  name: string\r\n  bundle: any\r\n  buildStartTime: number\r\n  buildEndTime: number\r\n  analyzeEndTime?: number\r\n  analyzeStartTime?: number\r\n  testStartTime?: number\r\n  testEndTime?: number\r\n}\r\n\r\nexport enum FileType  {\r\n  ANALYZE = 'ANALYZE',\r\n  TEST = 'TEST',\r\n  POST_ANALYZE = 'POST_ANALYZE',\r\n  DONE = 'DONE'\r\n}\r\n\r\nexport interface MetaStack {\r\n  file: string\r\n  source: string\r\n  name: string\r\n  line: Number\r\n  column: Number\r\n  originalSource: string\r\n  OriginalName: string\r\n  originalLine: Number\r\n  originalColumn: Number\r\n}\r\n\r\nexport interface TestError {\r\n  message: string\r\n  name: string\r\n  stack: string\r\n  metaStack: MetaStack[]\r\n  string: string\r\n  originalStack: string\r\n}\r\n\r\n/**\r\n * Representation of a file\r\n */\r\nexport interface File {\r\n  type?: FileType\r\n\r\n  target: TARGET\r\n  /**\r\n   * Path of the source test file\r\n   */\r\n  name: string\r\n  /**\r\n   * Path of the bundled test file\r\n   */\r\n  path: string\r\n  /**\r\n   * Url by which browsers can access the test file\r\n   */\r\n  url?: string\r\n  /**\r\n   * Test ran\r\n   */\r\n  test?: Test\r\n  /**\r\n   * Array of analyzed tests\r\n   */\r\n  tests?: Test[]\r\n  /**\r\n   * Array of errors\r\n   */\r\n  errors?: TestError[]\r\n}\r\n\r\n/**\r\n * Representation of a test\r\n */\r\nexport interface Test {\r\n  /**\r\n   * Description of the test\r\n   */\r\n  description: string\r\n  /**\r\n   * Body of the test (Function stringified)\r\n   */\r\n  body: string\r\n  /**\r\n   * Type of test\r\n   */\r\n  // type?: Function | Promise<any> | Observable<any>\r\n  type?: string\r\n  /**\r\n   * Value returned by the test\r\n   */\r\n  value?: any\r\n  /**\r\n   * Error thrown by the test\r\n   */\r\n  errors?: TestError[]\r\n\r\n  timeStart?: Number\r\n\r\n  timeEnd?: Number\r\n  \r\n  /**\r\n   * Target\r\n   */\r\n  target?: TARGET\r\n  /**\r\n   * Code coverage of the test\r\n   */\r\n  coverage?: any\r\n}\r\n","import Path from 'path'\r\nimport ParcelBundler from 'parcel-bundler'\r\nimport { Observable } from 'rxjs'\r\nimport { Bundler } from '../types'\r\nimport { publish } from 'rxjs/operators'\r\n\r\nexport default (options): Bundler =>\r\n  // @ts-ignore\r\n  (Observable.create(observer => {\r\n    const bundler = new ParcelBundler(options.entryFiles, options)\r\n    bundler.addAssetType('js', Path.resolve(__dirname, '../src/core/js-asset.ts'))\r\n    bundler.addAssetType('ts', Path.resolve(__dirname, '../src/core/ts-asset.ts'))\r\n    bundler.on('bundled', bundle =>\r\n      observer.next({ options, name: 'bundled', bundle, buildEndTime: Date.now() }))\r\n    bundler.on('buildStart', entryFiles  =>\r\n      observer.next({ options, name: 'buildStart', entryFiles , buildStartTime: Date.now() }))\r\n    bundler.on('buildEnd', _ =>\r\n      observer.next({ name: 'buildEnd' }))\r\n    bundler.on('buildError', error =>\r\n      observer.next({ name:'error', error }))\r\n    \r\n    bundler.bundle()\r\n    return _ => bundler.stop()\r\n  })\r\n  // @ts-ignore\r\n  |> publish())\r\n  // @ts-ignore\r\n  .refCount()","import path from 'path'\r\n\r\nexport const prettifyPath = _path => path.relative(process.cwd(), _path)\r\n\r\nexport const getEmptyPageUrl = port =>\r\n  transformPathToEpkUrl(path.resolve(__dirname, '..', 'dist', 'empty.html'), port)\r\n\r\n\r\nexport const transformPathToTestUrl = (_path, port) =>\r\n  `${port ? `http://localhost:${port}` : ''}${_path.replace(`${path.resolve(process.cwd(), '.epk', 'dist')}\\\\`, '/tests/').replace('\\\\', '/')}`\r\n  \r\nexport const transformPathToEpkUrl = (_path, port) =>\r\n  `${port ? `http://localhost:${port}` : ''}${_path.replace(`${path.resolve(__dirname, '..', 'dist')}\\\\`, '/epk/').replace('\\\\', '/')}`\r\n","// from https://github.com/parcel-bundler/parcel/tree/master/packages/core/logger/src\r\n\r\nimport Chalk from 'Chalk'\r\nimport readline from 'readline'\r\nimport { countBreaks } from 'grapheme-breaker'\r\nimport stripAnsi from 'strip-ansi'\r\nimport ora from 'ora'\r\nimport path from 'path'\r\nimport fs from 'fs'\r\n\r\nconst prettyError = (err, { color } = { color: undefined }) => {\r\n  let message = typeof err === 'string' ? err : err.message\r\n  if (!message) message = 'Unknown error'\r\n\r\n  if (err.fileName) {\r\n    let fileName = err.fileName\r\n    if (err.loc) {\r\n      fileName += `:${err.loc.line}:${err.loc.column}`\r\n    }\r\n\r\n    message = `${fileName}: ${message}`\r\n  }\r\n\r\n  let stack\r\n  if (err.codeFrame) {\r\n    stack = (color && err.highlightedCodeFrame) || err.codeFrame\r\n  } else if (err.stack) {\r\n    stack = err.stack.slice(err.stack.indexOf('\\n') + 1)\r\n  }\r\n\r\n  return {\r\n    message, stack\r\n  }\r\n}\r\n\r\nconst supportsEmoji =\r\n  process.platform !== 'win32' || process.env.TERM === 'xterm-256color'\r\n\r\n// Fallback symbols for Windows from https://en.wikipedia.org/wiki/Code_page_437\r\nconst defaultEmojis = {\r\n  progress: supportsEmoji ? '⏳' : '∞',\r\n  success: supportsEmoji ? '✨' : '√',\r\n  error: supportsEmoji ? '🚨' : '×',\r\n  warning: supportsEmoji ? '⚠️' : '‼'\r\n}\r\n\r\nconst countLines = str =>\r\n  stripAnsi(str)\r\n    .split('\\n')\r\n    .reduce((p, line) =>\r\n      process.stdout.columns\r\n        ? p + Math.ceil((line.length || 1) / process.stdout.columns)\r\n        : p + 1, 0)\r\n\r\n// Pad a string with spaces on either side\r\nconst pad = (text, length, align = 'left') => {\r\n  const pad = ' '.repeat(length - stringWidth(text))\r\n  if (align === 'right') return `${pad}${text}`\r\n  return `${text}${pad}`\r\n}\r\n\r\n// Count visible characters in a string\r\nconst stringWidth = str =>\r\n  // @ts-ignore\r\n  `${str}`\r\n  // @ts-ignore\r\n  |> stripAnsi\r\n  // @ts-ignore\r\n  |> countBreaks\r\n\r\nconst Logger = ({\r\n  logLevel = 3,\r\n  color = Chalk.supportsColor,\r\n  emojis = defaultEmojis,\r\n  chalk = new Chalk.constructor({ enabled: color }),\r\n  isTest = process.env.NODE_ENV === 'test'\r\n} = {}) => {\r\n  let lines = 0\r\n  let spinner\r\n  let logFile\r\n\r\n  const writeRaw = str => {\r\n    stopSpinner()\r\n    lines += countLines(str) - 1\r\n    process.stdout.write(str)\r\n  }\r\n\r\n  const write = (message, persistent = false) => {\r\n    if (logLevel > 3) {\r\n      return verbose(message)\r\n    }\r\n\r\n    if (!persistent) {\r\n      lines += countLines(message)\r\n    }\r\n\r\n    stopSpinner()\r\n    _log(message)\r\n  }\r\n\r\n  const verbose = str => {\r\n    if (logLevel < 4) return\r\n    let currDate = new Date()\r\n    str = `[${currDate.toLocaleTimeString()}]: ${str}`\r\n    if (logLevel > 4) {\r\n      if (!logFile) {\r\n        logFile = fs.createWriteStream(\r\n          path.join(process.cwd(), `parcel-debug-${currDate.toISOString()}.log`)\r\n        )\r\n      }\r\n      logFile.write(stripAnsi(str) + '\\n')\r\n    }\r\n    _log(str)\r\n  }\r\n\r\n  const log = str =>\r\n    logLevel >= 3 &&\r\n    write(str)\r\n\r\n  const persistent = str =>\r\n    logLevel >= 3 &&\r\n    write(chalk.bold(str), true)\r\n\r\n  const warn = err =>\r\n    logLevel >= 2 &&\r\n    _writeError(err, emojis.warning, chalk.yellow)\r\n\r\n  const error = err =>\r\n    logLevel >= 1 &&\r\n    _writeError(err, emojis.error, chalk.red.bold)\r\n\r\n  const success = str =>\r\n    log(`${emojis.success}  ${chalk.green.bold(str)}`)\r\n\r\n  const formatError = (err, options) => prettyError(err, options)\r\n\r\n  const _writeError = (err, emoji, _color) => {\r\n    const { message, stack } = formatError(err, { color })\r\n    write(_color(`${emoji}  ${message}`))\r\n    if (stack) write(stack)\r\n  }\r\n\r\n  const clear = () => {\r\n    if (!color || isTest || logLevel > 3) return\r\n\r\n    while (lines > 0) {\r\n      readline.clearLine(process.stdout, 0)\r\n      readline.moveCursor(process.stdout, 0, -1)\r\n      lines--\r\n    }\r\n\r\n    readline.cursorTo(process.stdout, 0)\r\n    stopSpinner()\r\n  }\r\n\r\n  const progress = str => {\r\n    if (logLevel < 3) return\r\n    else if (logLevel > 3) return verbose(str)\r\n\r\n    const styledMessage = chalk.gray.bold(str)\r\n    if (!spinner) {\r\n      spinner = ora({\r\n        text: styledMessage,\r\n        stream: process.stdout,\r\n        enabled: isTest ? false : undefined // fall back to ora default unless we need to explicitly disable it.\r\n      }).start()\r\n    } else spinner.text = styledMessage\r\n  }\r\n\r\n  const stopSpinner = () => {\r\n    if (spinner) {\r\n      spinner.stop()\r\n      spinner = null\r\n    }\r\n  }\r\n\r\n  const _log = str => console.log(str)\r\n\r\n  const table = (columns, table) => {\r\n    // Measure column widths\r\n    let colWidths = []\r\n    for (let row of table) {\r\n      let i = 0\r\n      for (let item of row) {\r\n        colWidths[i] = Math.max(colWidths[i] || 0, stringWidth(item))\r\n        i++\r\n      }\r\n    }\r\n\r\n    // Render rows\r\n    for (let row of table) {\r\n      log(\r\n        row.map((item, i) => {\r\n          // Add padding between columns unless the alignment is the opposite to the\r\n          // next column and pad to the column width.\r\n          let padding =\r\n            !columns[i + 1] || columns[i + 1].align === columns[i].align ? 4 : 0\r\n          return pad(item, colWidths[i] + padding, columns[i].align)\r\n        })\r\n        .join('')\r\n      )\r\n    }\r\n  }\r\n\r\n  const logger = {\r\n    writeRaw,\r\n    write,\r\n    verbose,\r\n    log,\r\n    persistent,\r\n    warn,\r\n    error,\r\n    success,\r\n    formatError,\r\n    _writeError,\r\n    clear,\r\n    progress,\r\n    stopSpinner,\r\n    _log,\r\n    table,\r\n    handleMessage: undefined,\r\n  }\r\n\r\n  const handleMessage = ({ method, args }) => logger[method](...args)\r\n  logger.handleMessage = handleMessage\r\n\r\n  return logger\r\n}\r\n\r\nexport default Logger()\r\n","// https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/utils/installPackage.js\r\n\r\nimport config from 'parcel-bundler/src/utils/config'\r\nimport commandExists from 'command-exists'\r\nimport logger from '../cli/logger'\r\nimport pipeSpawn from 'parcel-bundler/src/utils/pipeSpawn'\r\nimport PromiseQueue from 'parcel-bundler/src/utils/PromiseQueue'\r\nimport path from 'path'\r\nimport fs from '@parcel/fs'\r\nimport WorkerFarm from '@parcel/workers'\r\nimport utils from '@parcel/utils'\r\nimport _resolve from 'resolve'\r\n\r\nconst { promisify } = utils\r\nconst resolve  = promisify(_resolve)\r\n\r\nconst YARN_LOCK = 'yarn.lock'\r\n\r\nasync function install(modules, filepath, options = { installPeers: true, saveDev: true, packageManager: undefined }) {\r\n  let { installPeers = true, saveDev = true, packageManager } = options\r\n  if (typeof modules === 'string') {\r\n    modules = [modules]\r\n  }\r\n\r\n  logger.progress(`Installing ${modules.join(', ')}...`)\r\n\r\n  let packageLocation = await config.resolve(filepath, ['package.json'])\r\n  let cwd = packageLocation ? path.dirname(packageLocation) : process.cwd()\r\n\r\n  if (!packageManager) {\r\n    packageManager = await determinePackageManager(filepath)\r\n  }\r\n\r\n  let commandToUse = packageManager === 'npm' ? 'install' : 'add'\r\n  let args = [commandToUse, ...modules]\r\n  if (saveDev) {\r\n    args.push('-D')\r\n  } else if (packageManager === 'npm') {\r\n    args.push('--save')\r\n  }\r\n\r\n  // npm doesn't auto-create a package.json when installing,\r\n  // so create an empty one if needed.\r\n  if (packageManager === 'npm' && !packageLocation) {\r\n    await fs.writeFile(path.join(cwd, 'package.json'), '{}')\r\n  }\r\n\r\n  try {\r\n    await pipeSpawn(packageManager, args, {cwd})\r\n  } catch (err) {\r\n    throw new Error(`Failed to install ${modules.join(', ')}.`)\r\n  }\r\n\r\n  if (installPeers) {\r\n    await Promise.all(\r\n      modules.map(m => installPeerDependencies(filepath, m, options))\r\n    )\r\n  }\r\n}\r\n\r\nasync function installPeerDependencies(filepath, name, options) {\r\n  let basedir = path.dirname(filepath)\r\n  const [resolved] = await resolve(name, {basedir})\r\n  const pkg = await config.load(resolved, ['package.json'])\r\n  const peers = pkg.peerDependencies || {}\r\n\r\n  const modules = []\r\n  for (const peer in peers) {\r\n    modules.push(`${peer}@${peers[peer]}`)\r\n  }\r\n\r\n  if (modules.length) {\r\n    await install(\r\n      modules,\r\n      filepath,\r\n      Object.assign({}, options, {installPeers: false})\r\n    )\r\n  }\r\n}\r\n\r\nasync function determinePackageManager(filepath) {\r\n  const yarnLockFile = await config.resolve(filepath, [YARN_LOCK])\r\n\r\n  /**\r\n   * no yarn.lock => use npm\r\n   * yarn.lock => Use yarn, fallback to npm\r\n   */\r\n  if (!yarnLockFile) {\r\n    return 'npm'\r\n  }\r\n\r\n  const hasYarn = await checkForYarnCommand()\r\n  if (hasYarn) {\r\n    return 'yarn'\r\n  }\r\n\r\n  return 'npm'\r\n}\r\n\r\nlet hasYarn = null\r\nasync function checkForYarnCommand() {\r\n  if (hasYarn != null) {\r\n    return hasYarn\r\n  }\r\n\r\n  try {\r\n    hasYarn = await commandExists('yarn')\r\n  } catch (err) {\r\n    hasYarn = false\r\n  }\r\n\r\n  return hasYarn\r\n}\r\n\r\nlet queue = new PromiseQueue(install, {maxConcurrent: 1, retry: false})\r\nexport default async function(...args) {\r\n  // Ensure that this function is always called on the master process so we\r\n  // don't call multiple installs in parallel.\r\n  if (WorkerFarm.isWorker()) {\r\n    await WorkerFarm.callMaster({\r\n      location: __filename,\r\n      args\r\n    })\r\n    return\r\n  }\r\n\r\n  queue.add(...args)\r\n  return queue.run()\r\n}\r\n\r\n// export default async (...names) => {\r\n//   await _installPackage(names)\r\n//   return names.length === 1\r\n//           ? import(name)\r\n//           : Promise.all(names.map(name => import(name)))\r\n// }","// https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/utils/getModuleParts.js\r\nimport path from 'path'\r\n\r\nexport default function(name) {\r\n  let parts = path.normalize(name).split(path.sep)\r\n  if (parts[0].charAt(0) === '@') {\r\n    // Scoped module (e.g. @scope/module). Merge the first two parts back together.\r\n    parts.splice(0, 2, `${parts[0]}/${parts[1]}`)\r\n  }\r\n\r\n  return parts\r\n}","// https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/utils/localRequire.js\r\nimport Path, { dirname } from 'path'\r\nimport utils from '@parcel/utils'\r\nimport Resolve from 'resolve'\r\nimport installPackage from './installPackage'\r\nimport getModuleParts from './getModuleParts'\r\n\r\nconst { promisify } = utils\r\nconst _resolve = promisify(Resolve)\r\n\r\nconst cache = new Map();\r\n\r\nexport const localRequire = async (name, path, triedInstall = false) => {\r\n  const [resolved] = await resolve(name, path, triedInstall)\r\n  return require(resolved)\r\n}\r\n\r\nexport const resolve = async (name, path, triedInstall = false) => {\r\n  let basedir = dirname(path)\r\n  let key = basedir + ':' + name\r\n  let resolved = cache.get(key)\r\n  if (!resolved) {\r\n    try {\r\n      resolved = await _resolve(name, {basedir})\r\n    } catch (e) {\r\n      if (e.code === 'MODULE_NOT_FOUND' && !triedInstall) {\r\n        const packageName = getModuleParts(name)[0]\r\n        await installPackage(packageName, path)\r\n        return resolve(name, path, true)\r\n      }\r\n      throw e\r\n    }\r\n    cache.set(key, resolved)\r\n  }\r\n  return resolved\r\n}\r\n\r\nexport default async (packages, path = __dirname.includes('node_modules') ? Path.resolve(__dirname, '..', '..') : __dirname) =>\r\n  typeof packages === 'string'\r\n    ? localRequire(packages, path)\r\n    : Promise.all(packages.map(pkg => localRequire(pkg, path)))\r\n","import path from 'path'\r\nimport { Observable } from 'rxjs'\r\nimport localRequire from '../utils/localRequire'\r\nimport { TargetRuntimeObservable } from '../types'\r\nimport { transformPathToEpkUrl } from '../utils'\r\n\r\nlet pptr\r\n\r\nexport default (options): TargetRuntimeObservable =>\r\n  Observable.create(observer => {\r\n    if (!pptr) pptr = localRequire('puppeteer')\r\n\r\n    let closed\r\n    const browser = pptr.then(pptr => pptr.launch({ devtools: true }))\r\n\r\n    browser.then(browser => {\r\n      if (closed) return\r\n      observer.next(Observable.create(observer => {\r\n        const page = browser.newPage()\r\n        const emptyHTMLFilePath = path.resolve(__dirname, '..', 'dist', 'empty.html')\r\n        const url = transformPathToEpkUrl(emptyHTMLFilePath, options.port)\r\n        page.then(page => {\r\n          observer.next({\r\n            loadFile: file => page.goto(url).then(() => page.addScriptTag({ url: file.url })),\r\n            exec: str => page.evaluate(str)\r\n          })\r\n        })\r\n        return () => page.then(page => page.close())\r\n      }))\r\n    })\r\n\r\n    return () => {\r\n      closed = true\r\n      browser.then(browser => browser.close())\r\n    }\r\n  })\r\n","import { TARGET, TargetRuntimeProviderOptions, TargetRuntimeProvider, TargetRuntimeObservable } from '../types'\r\nimport ChromeRuntime from '../targets/chrome'\r\nimport { map } from 'rxjs/operators'\r\n// import FirefoxRuntime from '../targets/firefox'\r\n\r\nconst targetRuntimes = new Map([\r\n  [TARGET.CHROME, ChromeRuntime],\r\n  // [TARGET.FIREFOX, FirefoxRuntime]\r\n])\r\n\r\nexport default\r\n  (target: TARGET, options: TargetRuntimeProviderOptions): TargetRuntimeProvider => {\r\n    const targetRuntimeProvider = targetRuntimes.get(target)(options)\r\n    targetRuntimeProvider.target = target\r\n    targetRuntimeProvider.options = options\r\n    // @ts-ignore\r\n    return targetRuntimeProvider\r\n      // @ts-ignore\r\n      |> map((targetRuntime: TargetRuntimeObservable) => {\r\n        targetRuntime.target = target\r\n        targetRuntime.options = options\r\n        return targetRuntime\r\n      })\r\n  }\r\n","\r\nexport const stringify = (strings, ...vals) =>\r\n  strings.reduce((finalStr, str, i) =>\r\n    `${finalStr}${str}${vals.length > i ? JSON.stringify(vals[i]) : ''}`, '')\r\n\r\nexport const prettifyTime = time =>\r\n  time < 1000\r\n    ? `${time.toFixed()}ms`\r\n    : `${(time / 1000).toFixed(2)}s`\r\n\r\nexport const isBrowser = typeof window !== 'undefined'\r\n","import { switchMap, map, mergeMap, take, delay } from 'rxjs/operators'\r\nimport { TargetRuntime, BUNDLER_TARGET, NODE_GLOBAL, MESSAGE_TYPE, File, FileType } from '../types'\r\nimport { stringify } from './utils'\r\n\r\nconst browserStr = data => stringify`\r\nnew Promise(resolve => {\r\n  window.addEventListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.GET_TESTS_RESPONSE}\r\n    && resolve(data))\r\n  window.postMessage(${data}, '*')\r\n})\r\n`\r\n\r\nconst nodeStr = data => stringify`\r\nnew Promise(resolve => {\r\n  global[${NODE_GLOBAL}].addListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.GET_TESTS_RESPONSE}\r\n    && resolve(data))\r\n  global[${NODE_GLOBAL}].emit('message', ${data})\r\n})\r\n`\r\n\r\nconst analyzeStr = (options, data) =>\r\n  options.target === BUNDLER_TARGET.BROWSER\r\n    ? browserStr(data)\r\n    : nodeStr(data)\r\n\r\nexport default\r\n  (targetRuntimeProvider, options) =>\r\n    // @ts-ignore\r\n    switchMap((file: File) =>\r\n      // @ts-ignore\r\n      targetRuntimeProvider\r\n      // @ts-ignore\r\n      |> mergeMap(async (targetRuntime: TargetRuntime) => {\r\n        await targetRuntime.loadFile(file)\r\n        const { data: tests, errors } = await targetRuntime.exec(analyzeStr(options, { type: MESSAGE_TYPE.GET_TESTS }))\r\n        return {\r\n          type: FileType.ANALYZE,\r\n          ...file,\r\n          tests,\r\n          errors\r\n        }\r\n      })\r\n      // @ts-ignore\r\n      |> take(1))\r\n","import { switchMap, mergeMap, take } from 'rxjs/operators'\r\nimport { TargetRuntime, BUNDLER_TARGET, NODE_GLOBAL, MESSAGE_TYPE, FileType } from '../types'\r\nimport { stringify } from './utils'\r\n\r\nconst browserStr = data => stringify`\r\nnew Promise(resolve => {\r\n  window.addEventListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.RUN_TEST_RESPONSE}\r\n    && resolve(data))\r\n  window.postMessage(${data}, '*')\r\n})\r\n`\r\n\r\nconst nodeStr = data => stringify`\r\nnew Promise(resolve => {\r\n  global[${NODE_GLOBAL}].addListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.RUN_TEST_RESPONSE}\r\n    && resolve(data))\r\n  global[${NODE_GLOBAL}].emit('message', ${data})\r\n})\r\n`\r\n\r\nconst testStr = (options, data) =>\r\n  options.target === BUNDLER_TARGET.BROWSER\r\n    ? browserStr(data)\r\n    : nodeStr(data)\r\n\r\nexport default\r\n  (file, targetRuntimeProvider, options) =>\r\n    mergeMap(test =>\r\n      // @ts-ignore\r\n      targetRuntimeProvider\r\n      // @ts-ignore\r\n      |> mergeMap(async (targetRuntime: TargetRuntime) => {\r\n        await targetRuntime.loadFile(file)\r\n        const { data: result } = await targetRuntime.exec(testStr(options, { type: MESSAGE_TYPE.RUN_TEST, description: test.description }))\r\n        return {\r\n          ...file,\r\n          type: FileType.TEST,\r\n          test: {\r\n            ...test,\r\n            ...result\r\n          }\r\n        }\r\n      })\r\n      // @ts-ignore\r\n      |> take(1))\r\n","import stackTraceParser from 'stacktrace-parser'\r\nimport SourceMap from 'source-map'\r\nimport { mergeMap } from 'rxjs/operators'\r\nimport { File, FileType, Test, TestError } from '../types'\r\nimport Path from 'path'\r\nimport fs from 'fs'\r\nimport { promisify } from 'util'\r\nimport { prettifyPath } from '../utils/index'\r\n\r\nconst readFile = promisify(fs.readFile)\r\n\r\nconst makeStackLocation = ({ originalColumn, originalLine, source }) => `\\\r\n${source}:${originalLine}:${originalColumn}`\r\n\r\nconst makeStackLines = metaLine => `\\\r\nat ${metaLine.originalName ? `${metaLine.originalName} (${makeStackLocation(metaLine)})` : makeStackLocation(metaLine)}`\r\n\r\nconst makeStack = (error: TestError) => `\\\r\n${error.name}: ${error.message}\r\n\r\n${error\r\n  .metaStack\r\n  .map(makeStackLines)\r\n  .join('\\n')}\r\n`\r\n\r\n\r\nexport default bundle => {\r\n  const files = new Map()\r\n  const sourceMapConsumers = new Map()\r\n\r\n  return mergeMap(async (file: File) => {\r\n    const { name: path } = bundle\r\n    \r\n    if (!files.has(path)) {\r\n      const content = await readFile(path, { encoding: 'utf8' })\r\n      files.set(path, content)\r\n    }\r\n\r\n    for (const childBundle of bundle.childBundles) {\r\n      const { name: path } = childBundle\r\n      if (!files.has(path)) {\r\n        const content = await readFile(path, { encoding: 'utf8' })\r\n        files.set(path, content)\r\n      }\r\n    }\r\n\r\n    const sourceMapPath = `${path.slice(0, -3)}.map`\r\n    const sourceMap = JSON.parse(files.get(sourceMapPath))\r\n\r\n    const sourceMapConsumer = sourceMapConsumers.get(file.url) || new SourceMap.SourceMapConsumer(sourceMap)\r\n    if(!sourceMapConsumers.has(file.url)) sourceMapConsumers.set(file.url, sourceMapConsumer)\r\n\r\n    const { test: { errors } } = file\r\n    const errorsWithMetadata =\r\n      await Promise.all(\r\n        errors.map(async error => {\r\n          const metaStack =\r\n            await Promise.all(\r\n              stackTraceParser\r\n                .parse(\r\n                  error.name === 'AssertionError'\r\n                    ? error.stack.replace(error.string, '')\r\n                    : error.stack)\r\n                .map(async ({ lineNumber: line, column, file, methodName: name }) => {\r\n                  const { line: originalLine, column: originalColumn, name: originalName, source } = await sourceMapConsumer.originalPositionFor({ line, column: column === null ? 0 : column })\r\n                  return {\r\n                    file,\r\n                    name,\r\n                    line,\r\n                    column,\r\n                    originalLine,\r\n                    originalColumn,\r\n                    originalName,\r\n                    source: prettifyPath(Path.resolve(Path.dirname(path), source.replace('tests\\\\unit/..', '')))\r\n                  }\r\n                })\r\n            )\r\n          const testError = {\r\n            ...error,\r\n            metaStack\r\n          }\r\n          testError.originalStack = makeStack(testError)\r\n          return testError\r\n        })\r\n      )\r\n\r\n    return {\r\n      ...file,\r\n      type: FileType.POST_ANALYZE,\r\n      test: {\r\n        ...file.test,\r\n        errors: errorsWithMetadata\r\n      }\r\n    }\r\n  })\r\n}\r\n","import path from 'path'\r\nimport { Observable } from 'rxjs'\r\nimport { switchMap } from 'rxjs/operators'\r\nimport localRequire from '../utils/localRequire'\r\n\r\nlet imports\r\n\r\nexport default options =>\r\n  switchMap(val =>\r\n    Observable.create(observer => {\r\n      const { port } = options\r\n      if (!imports) imports = localRequire(['koa', 'koa-static', 'koa-mount'])\r\n\r\n      const app = imports.then(([Koa, serve, mount]) => {\r\n        const app = new Koa()\r\n        const epk = new Koa()\r\n        epk.use(serve(path.resolve(__dirname, '..', 'dist')))\r\n        const tests = new Koa()\r\n        tests.use(serve(path.resolve(process.cwd(), '.epk', 'dist')))\r\n        \r\n        app.use(mount('/epk', epk))\r\n        app.use(mount('/tests', tests))\r\n        try {\r\n          return app.listen(port)\r\n        } finally {\r\n          observer.next(val)\r\n        }\r\n      })\r\n\r\n      return _ => app.then(app => app.close())\r\n    })\r\n  )\r\n","import { merge, ConnectableObservable, from, of } from 'rxjs'\r\nimport { map, filter, mergeMap, switchMap, publish, tap, delayWhen } from 'rxjs/operators'\r\n\r\nimport { Options, BUNDLER_TARGET, TARGET, File, TargetRuntimeProvider as TargetRuntimeProviderType } from '../types'\r\nimport Bundler from './bundler'\r\nimport { transformPathToTestUrl } from '../utils/index'\r\nimport TargetRuntimeProvider from './target-runtime-provider'\r\nimport analyze from './analyze'\r\nimport test from './test'\r\nimport postAnalyze from './post-analyze'\r\nimport { isBrowser } from './utils'\r\nimport server from './server'\r\nimport localRequire from '../utils/localRequire'\r\n\r\n\r\nexport default (_options: Options) => {\r\n  // remove undefined values\r\n  Object.keys(_options).forEach(key => _options[key] === undefined && delete _options[key])\r\n\r\n  const target = _options.target || BUNDLER_TARGET.BROWSER\r\n  const options = {\r\n    browsers: ['chrome'],\r\n    target,\r\n    outDir: `.epk/dist/${target}`,\r\n    watch: true,\r\n    cache: true,\r\n    cacheDir: `.epk/cache/${target}`,\r\n    port: undefined,\r\n    minify: false,\r\n    scopeHoist: false,\r\n    logLevel: 0, // 3 = log everything, 2 = log warnings & errors, 1 = log errors\r\n    sourceMaps: true, // Enable or disable sourcemaps, defaults to enabled (minified builds currently always create sourcemaps)\r\n    detailedReport: false,\r\n    throwErrors: true,\r\n    hmr: false,\r\n    // apply options\r\n    ..._options\r\n  }\r\n  let _port\r\n  if (!isBrowser && options.target === BUNDLER_TARGET.BROWSER) {\r\n    _port = localRequire('get-port')\r\n              .then(getPort => getPort({ port: 10485 }))\r\n              .then(port => (options.port = port))\r\n  }\r\n  // @ts-ignore\r\n  return of([\r\n            Bundler(options),\r\n            (!isBrowser && options.target === BUNDLER_TARGET.BROWSER\r\n              ? options.browsers as unknown as TARGET[]\r\n              : [options.target] as unknown as TARGET[])\r\n                .map(target => TargetRuntimeProvider(target, options))\r\n          ])\r\n          // @ts-ignore\r\n          |> (!isBrowser && options.target === BUNDLER_TARGET.BROWSER ? delayWhen(() => from(_port)) : tap())\r\n          // @ts-ignore\r\n          |> (!isBrowser && options.target === BUNDLER_TARGET.BROWSER ? server(options) : tap())\r\n          // @ts-ignore\r\n          |> mergeMap(([ bundler, targetRuntimeProviders ]) =>\r\n            merge(\r\n              // @ts-ignore\r\n              bundler |> filter(({ name }) => name === 'buildStart'),\r\n              // @ts-ignore\r\n              bundler |> filter(({ name }) => name === 'bundled'),\r\n              // @ts-ignore\r\n              merge(...targetRuntimeProviders)\r\n              // @ts-ignore\r\n              |> mergeMap((targetRuntimeProvider: TargetRuntimeProviderType) =>\r\n                // @ts-ignore\r\n                bundler\r\n                // @ts-ignore\r\n                |> filter(({ name }) => name === 'buildStart')\r\n                // @ts-ignore\r\n                |> switchMap(({ entryFiles, buildStartTime }) =>\r\n                  // @ts-ignore\r\n                  bundler\r\n                  // @ts-ignore\r\n                  |> filter(({ name }) => name === 'bundled')\r\n                  // @ts-ignore\r\n                  |> map(bundleContainer => ({\r\n                    ...bundleContainer,\r\n                    entryFiles,\r\n                    buildStartTime\r\n                  }))\r\n                )\r\n                // @ts-ignore\r\n                |> switchMap(({ bundle }) =>\r\n                  // @ts-ignore\r\n                  from(\r\n                    (bundle.isEmpty\r\n                      ? Array.from(bundle.childBundles)\r\n                      : [bundle]))\r\n                    // @ts-ignore\r\n                    |> mergeMap((childBundle: any) => {\r\n                      const { name: path } = childBundle\r\n                      // @ts-ignore\r\n                      const newContextObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        of({\r\n                          target: targetRuntimeProvider.target,\r\n                          name: childBundle.entryAsset.name,\r\n                          path,\r\n                          url: options.target === BUNDLER_TARGET.BROWSER && transformPathToTestUrl(path, options.port)\r\n                        })\r\n                        // @ts-ignore\r\n                        |> publish()\r\n\r\n                      // @ts-ignore\r\n                      const analyzedObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        newContextObservable\r\n                        // @ts-ignore\r\n                        |> analyze(targetRuntimeProvider, options)\r\n                        // @ts-ignore\r\n                        |> publish()\r\n          \r\n                      // @ts-ignore\r\n                      const testedObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        analyzedObservable\r\n                        // @ts-ignore\r\n                        |> filter(({ errors }) => !errors.length)\r\n                        // @ts-ignore\r\n                        |> switchMap(file =>\r\n                          // @ts-ignore\r\n                          from(file.tests)\r\n                          // @ts-ignore\r\n                          |> test(file, targetRuntimeProvider, options))\r\n                        // @ts-ignore\r\n                        |> publish()\r\n\r\n                      // @ts-ignore\r\n                      const postAnalyzeObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        testedObservable\r\n                        // @ts-ignore\r\n                        |> postAnalyze(childBundle)\r\n                        // @ts-ignore\r\n                        |> publish()\r\n          \r\n                      const testerObservable =\r\n                        merge(\r\n                          newContextObservable,\r\n                          analyzedObservable,\r\n                          testedObservable,\r\n                          postAnalyzeObservable\r\n                        )\r\n          \r\n                      postAnalyzeObservable.connect()\r\n                      testedObservable.connect()\r\n                      analyzedObservable.connect()\r\n                      newContextObservable.connect()\r\n\r\n                      return testerObservable\r\n                    })\r\n              )\r\n            )\r\n          )\r\n        )\r\n}\r\n","import { isBrowser } from '../core/utils'\r\n\r\nexport const errors = []\r\n\r\nif (isBrowser) {\r\n  window.addEventListener('error', err => errors.push(err))\r\n} else {\r\n  process.on('uncaughtException', err => errors.push(err))\r\n}\r\n\r\n","import { EventEmitter } from 'events'\r\nimport { stringify } from 'flatted/cjs'\r\nimport { isBrowser } from '../core/utils'\r\nimport { File, Test, TestResult, MESSAGE_TYPE, NODE_GLOBAL } from '../types'\r\nimport { errors } from './error'\r\nimport { isObservable } from 'rxjs';\r\n\r\nexport const tests = new Map<string, Function>()\r\n\r\nexport const todo = _ => {}\r\nexport const pass = _ => {}\r\nexport const fail = _ => {}\r\n\r\nexport const test = (desc, func) => {\r\n  if (typeof desc !== 'string') throw new Error('desc has to be a string')\r\n  if (typeof func !== 'function') throw new Error('func has to be a function')\r\n  if (tests.has(desc)) throw new Error(`Found duplicate test description: ${desc}`)\r\n  tests.set(desc, func)\r\n}\r\n\r\nconst initiated = new Promise(resolve => setTimeout(resolve, 0))\r\n\r\nconst emit = (type, data) =>\r\n  isBrowser\r\n    ? window.parent.postMessage({ type, errors, data }, '*')\r\n    : global[NODE_GLOBAL].emit('message', { type, errors, data })\r\n\r\nconst getTests = () =>\r\n  emit(\r\n    MESSAGE_TYPE.GET_TESTS_RESPONSE,\r\n    Array\r\n      .from(tests)\r\n      .map(([description, func]) => ({\r\n        description,\r\n        body: func.toString()\r\n      }))\r\n  )\r\n\r\nconst runTest = async description => {\r\n  // todo: replace by \"isBrowser ? window : require('perf_hooks')\"\r\n  const { performance } = window\r\n  let timeStart, timeEnd, value, error\r\n\r\n  try {\r\n    timeStart = performance.now()\r\n    value = await tests.get(description)()\r\n  } catch (err) {\r\n    error = err\r\n  } finally {\r\n    timeEnd = performance.now()\r\n  }\r\n\r\n  emit(\r\n    MESSAGE_TYPE.RUN_TEST_RESPONSE,\r\n    {\r\n      timeStart,\r\n      timeEnd,\r\n      type:\r\n        isObservable(value) ? 'observable'\r\n        : value instanceof Promise ? 'promise'\r\n        : 'function',\r\n      value: stringify(value),\r\n      errors:\r\n        (error\r\n          ? [error, ...errors]\r\n          : errors).map(err => ({\r\n            name: err.name,\r\n            message: err.message,\r\n            string: err.toString(),\r\n            stack: err.stack\r\n          }))\r\n    }\r\n  )\r\n}\r\n\r\nconst newEvent = ({ data: { type, description } }) =>\r\n    type === MESSAGE_TYPE.GET_TESTS ? getTests()\r\n  : type === MESSAGE_TYPE.RUN_TEST && runTest(description)\r\n\r\nif (isBrowser) {\r\n  window.addEventListener('message', newEvent)\r\n} else {\r\n  const events = global[NODE_GLOBAL] = new EventEmitter()\r\n  events.addListener('message', newEvent)\r\n}\r\n\r\n// const addEventListener =\r\n//   isBrowser\r\n//     ? window.addEventListener\r\n//     : global[NODE_GLOBAL].addListener\r\n\r\n// addEventListener('message', ({ data: { type, description } }) =>\r\n//     type === MESSAGE_TYPE.GET_TESTS ? getTests()\r\n//   : type === MESSAGE_TYPE.RUN_TEST && runTest(description))\r\n","import PowerAssert from 'power-assert'\r\n\r\nexport const assert = PowerAssert.customize({\r\n\r\n})","// export * from './test'\r\n// export * from './assert'\r\n\r\n// parceljs experimental hoisting fix\r\nimport { test } from './test'\r\nimport { assert } from './assert'\r\n\r\nexport {\r\n  test,\r\n  assert\r\n}","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","export * from './core/index'\r\nexport * from './test/index'\r\n\r\nif (!module.parent) import('./cli/index').then(() => {}) // keep the then because parcel lazy-load imports\r\n"]}