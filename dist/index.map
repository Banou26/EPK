{"version":3,"sources":["types.ts","core/bundler.ts","utils/index.ts","cli/logger.ts","utils/installPackage.ts","utils/getModuleParts.ts","utils/localRequire.ts","targets/chrome.ts","core/target-runtime-provider.ts","core/utils.ts","core/analyze.ts","core/test.ts","core/server.ts","core/index.ts","test/error.ts","test/test.ts","test/assert.ts","test/index.ts","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/bundle-loader.js","index.ts"],"names":["FileType","NODE_GLOBAL","TARGET","BROWSER_TARGET","BUNDLER_TARGET","CHROME_EXTENSION","CHROME_CANARY","CHROME_CANARY_EXTENSION","FIREFOX","FIREFOX_EXTENSION","FIREFOX_NIGHTLY","FIREFOX_NIGHTLY_EXTENSION","targetToBundlerTarget","target","BROWSER","NODE","ELECTRON","MESSAGE_TYPE","options","Observable","create","observer","bundler","ParcelBundler","entryFiles","_","addAssetType","Path","resolve","__dirname","on","bundle","next","name","buildEndTime","Date","now","buildStartTime","error","stop","prettifyPath","_path","path","relative","process","cwd","getEmptyPageUrl","port","transformPathToEpkUrl","transformPathToTestUrl","replace","prettyError","err","color","undefined","message","stack","fileName","loc","line","column","codeFrame","highlightedCodeFrame","slice","indexOf","supportsEmoji","platform","env","TERM","defaultEmojis","progress","success","warning","countLines","str","split","reduce","p","stdout","columns","Math","ceil","length","pad","text","align","repeat","stringWidth","stripAnsi","countBreaks","Logger","logLevel","Chalk","supportsColor","emojis","chalk","constructor","enabled","isTest","NODE_ENV","lines","spinner","logFile","writeRaw","write","persistent","verbose","stopSpinner","_log","currDate","toLocaleTimeString","fs","createWriteStream","join","toISOString","log","formatError","_writeError","emoji","_color","console","logger","bold","warn","yellow","red","green","clear","clearLine","moveCursor","cursorTo","styledMessage","gray","stream","start","table","colWidths","row","i","item","max","map","padding","handleMessage","method","args","promisify","utils","_resolve","YARN_LOCK","install","modules","filepath","installPeers","saveDev","packageManager","packageLocation","config","dirname","determinePackageManager","commandToUse","push","writeFile","Error","Promise","all","m","installPeerDependencies","basedir","resolved","peers","load","peerDependencies","peer","Object","assign","checkForYarnCommand","hasYarn","queue","PromiseQueue","maxConcurrent","retry","WorkerFarm","isWorker","add","run","callMaster","location","__filename","parts","normalize","sep","charAt","splice","Resolve","cache","Map","localRequire","triedInstall","require","key","get","e","code","packageName","set","packages","pkg","pptr","closed","browser","then","launch","devtools","page","newPage","loadFile","file","goto","addScriptTag","url","exec","evaluate","close","targetRuntimes","CHROME","ChromeRuntime","targetRuntimeProvider","targetRuntime","stringify","strings","vals","finalStr","JSON","prettifyTime","time","toFixed","isBrowser","window","browserStr","data","GET_TESTS_RESPONSE","nodeStr","analyzeStr","tests","errors","type","GET_TESTS","ANALYZE","RUN_TEST_RESPONSE","testStr","test","result","RUN_TEST","description","TEST","imports","val","app","Koa","serve","mount","epk","use","listen","_options","keys","forEach","browsers","outDir","watch","cacheDir","minify","scopeHoist","sourceMaps","detailedReport","_port","getPort","targetRuntimeProviders","bundleContainer","isEmpty","Array","from","childBundles","newContextObservable","entryAsset","analyzedObservable","testedObservable","testerObservable","connect","addEventListener","todo","pass","fail","desc","func","has","initiated","setTimeout","emit","parent","postMessage","global","getTests","body","toString","runTest","performance","timeStart","timeEnd","value","newEvent","EventEmitter","addListener","assert","PowerAssert","customize","bundleURL","getBundleURLCached","getBundleURL","matches","match","getBaseURL","exports","loadBundlesLazy","bundles","isArray","id","LazyPromise","reject","loadBundles","loadBundle","bundleLoaders","registerBundleLoader","loader","module","register","substring","lastIndexOf","toLowerCase","bundleLoader","catch","executor","promise","prototype","onSuccess","onError"],"mappings":"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","file":"index.map","sourceRoot":"..\\src","sourcesContent":["import { Page as PPTRPage } from 'puppeteer'\r\nimport { Observable } from 'rxjs'\r\n\r\nexport const NODE_GLOBAL = '__EPK_NODE_GLOBAL'\r\n\r\n/**\r\n * List of different runtimes (available) to test on\r\n */\r\nexport enum TARGET {\r\n  NODE = 'node',\r\n  ELECTRON = 'electron',\r\n  DENO = 'deno',\r\n  CHROME = 'chrome',\r\n  CHROME_EXTENSION = 'chromeExtension',\r\n  CHROME_CANARY = 'chromeCanary',\r\n  CHROME_CANARY_EXTENSION = 'chromeCanaryExtension',\r\n  FIREFOX = 'firefox',\r\n  FIREFOX_EXTENSION = 'firefoxExtension',\r\n  FIREFOX_NIGHTLY = 'firefoxNightly',\r\n  FIREFOX_NIGHTLY_EXTENSION = 'firefoxNightlyExtension'\r\n}\r\n\r\nexport enum BROWSER_TARGET {\r\n  CHROME = TARGET.CHROME_EXTENSION,\r\n  CHROME_EXTENSION = TARGET.CHROME_CANARY,\r\n  CHROME_CANARY = TARGET.CHROME_CANARY_EXTENSION,\r\n  CHROME_CANARY_EXTENSION = TARGET.FIREFOX,\r\n  FIREFOX = TARGET.FIREFOX_EXTENSION,\r\n  FIREFOX_EXTENSION = TARGET.FIREFOX_NIGHTLY,\r\n  FIREFOX_NIGHTLY = TARGET.FIREFOX_NIGHTLY_EXTENSION,\r\n  FIREFOX_NIGHTLY_EXTENSION = TARGET.FIREFOX_NIGHTLY_EXTENSION\r\n}\r\n\r\nexport enum BUNDLER_TARGET {\r\n  NODE = 'node',\r\n  BROWSER = 'browser',\r\n  ELECTRON = 'electron'\r\n}\r\n\r\nexport const targetToBundlerTarget =\r\n  (target: TARGET): BUNDLER_TARGET =>\r\n    target in BROWSER_TARGET ? BUNDLER_TARGET.BROWSER\r\n    : target as unknown as BUNDLER_TARGET === BUNDLER_TARGET.NODE ? BUNDLER_TARGET.NODE\r\n    : target as unknown as BUNDLER_TARGET === BUNDLER_TARGET.ELECTRON && BUNDLER_TARGET.NODE\r\n\r\nexport interface Bundler extends Observable<any> {}\r\n\r\nexport interface TargetRuntime extends Observable<any> {\r\n  loadFile: Function\r\n  exec: Function\r\n}\r\nexport interface TargetRuntimeObservable extends Observable<TargetRuntime> {\r\n  target: TARGET\r\n  options: TargetRuntimeOptions\r\n}\r\n\r\nexport interface TargetRuntimeOptions {}\r\nexport interface TargetRuntimeProvider extends Observable<TargetRuntimeObservable> {\r\n  target: TARGET\r\n  options: TargetRuntimeOptions\r\n}\r\nexport interface TargetRuntimeProviderOptions {}\r\n\r\nexport enum MESSAGE_TYPE {\r\n  GET_TESTS = '__EPK_GET_TESTS',\r\n  RUN_TESTS = '__EPK_RUN_TESTS',\r\n  RUN_TEST = '__EPK_RUN_TEST',\r\n  GET_TESTS_RESPONSE = '__EPK_GET_TESTS_RESPONSE',\r\n  RUN_TESTS_RESPONSE = '__EPK_RUN_TESTS_RESPONSE',\r\n  RUN_TEST_RESPONSE = '__EPK_RUN_TEST_RESPONSE'\r\n}\r\n\r\nexport interface Message {\r\n  type: MESSAGE_TYPE,\r\n  payload: any\r\n}\r\n\r\nexport interface Options {\r\n  browsers?: BROWSER_TARGET[]\r\n  entryFiles: string[]\r\n  target: BUNDLER_TARGET\r\n  watch?: Boolean\r\n  outDir?: string\r\n  cache?: Boolean\r\n  cacheDir?: string\r\n  minify?: Boolean\r\n  scopeHoist?: Boolean\r\n  /**\r\n   * 0 = log nothing\r\n   * 1 = log errors\r\n   * 2 = log warnings & errors\r\n   * 3 = log everything\r\n   */\r\n  logLevel?: 0 | 1 | 2 | 3\r\n  sourceMaps?: Boolean\r\n  detailedReport?: Boolean\r\n}\r\n\r\nexport interface Target {\r\n  type: TARGET\r\n  test: Function\r\n  prepare: Function\r\n}\r\n\r\n/**\r\n * Context object of the testing pipeline that contains all the information needed for each testing steps\r\n */\r\nexport interface Context {\r\n  /**\r\n   * Options passed to epk\r\n   */\r\n  options: Options\r\n  /**\r\n   * Files found by the paths/globs\r\n   */\r\n  files: File[]\r\n  /**\r\n   * entryFiles from Parcel\r\n   */\r\n  entryFiles: string[]\r\n  /**\r\n   * Array of targets in which the tests will be executed\r\n   */\r\n  targets: TARGET[]\r\n  name: string\r\n  bundle: any\r\n  buildStartTime: number\r\n  buildEndTime: number\r\n  analyzeEndTime?: number\r\n  analyzeStartTime?: number\r\n  testStartTime?: number\r\n  testEndTime?: number\r\n}\r\n\r\nexport enum FileType  {\r\n  ANALYZE = 'ANALYZE',\r\n  TEST = 'TEST',\r\n  DONE = 'DONE'\r\n}\r\n\r\n/**\r\n * Representation of a file\r\n */\r\nexport interface File {\r\n  type?: FileType\r\n\r\n  target: TARGET\r\n  /**\r\n   * Path of the source test file\r\n   */\r\n  name: string\r\n  /**\r\n   * Path of the bundled test file\r\n   */\r\n  path: string\r\n  /**\r\n   * Url by which browsers can access the test file\r\n   */\r\n  url?: string\r\n  /**\r\n   * Test ran\r\n   */\r\n  test?: Test\r\n  /**\r\n   * Array of analyzed tests\r\n   */\r\n  tests?: Test[]\r\n  /**\r\n   * Array of errors\r\n   */\r\n  errors?: string[]\r\n}\r\n\r\n/**\r\n * Representation of a test\r\n */\r\nexport interface Test {\r\n  /**\r\n   * Description of the test\r\n   */\r\n  description: string\r\n  /**\r\n   * Body of the test (Function stringified)\r\n   */\r\n  body: String\r\n  /**\r\n   * Type of test\r\n   */\r\n  // type?: Function | Promise<any> | Observable<any>\r\n  type?: string\r\n  /**\r\n   * Value returned by the test\r\n   */\r\n  value?: any\r\n  /**\r\n   * Error thrown by the test\r\n   */\r\n  error?: Error\r\n\r\n  timeStart?: Number\r\n\r\n  timeEnd?: Number\r\n  \r\n  /**\r\n   * Target\r\n   */\r\n  target?: TARGET\r\n  /**\r\n   * Code coverage of the test\r\n   */\r\n  coverage?: any\r\n}\r\n","import Path from 'path'\r\nimport ParcelBundler from 'parcel-bundler'\r\nimport { Observable } from 'rxjs'\r\nimport { Bundler } from '../types'\r\n\r\nexport default (options): Bundler =>\r\n  Observable.create(observer => {\r\n    const bundler = new ParcelBundler(options.entryFiles, options)\r\n    bundler.addAssetType('js', Path.resolve(__dirname, '../src/core/js-asset.ts'))\r\n    bundler.addAssetType('ts', Path.resolve(__dirname, '../src/core/ts-asset.ts'))\r\n    bundler.on('bundled', bundle =>\r\n      observer.next({ options, name: 'bundled', bundle, buildEndTime: Date.now() }))\r\n    bundler.on('buildStart', entryFiles  =>\r\n      observer.next({ options, name: 'buildStart', entryFiles , buildStartTime: Date.now() }))\r\n    bundler.on('buildEnd', _ =>\r\n      observer.next({ name: 'buildEnd' }))\r\n    bundler.on('buildError', error =>\r\n      observer.next({ name:'error', error }))\r\n    \r\n    bundler.bundle()\r\n    return _ => bundler.stop()\r\n  })","import path from 'path'\r\n\r\nexport const prettifyPath = _path => path.relative(process.cwd(), _path)\r\n\r\nexport const getEmptyPageUrl = port =>\r\n  transformPathToEpkUrl(path.resolve(__dirname, '..', 'dist', 'empty.html'), port)\r\n\r\n\r\nexport const transformPathToTestUrl = (_path, port) =>\r\n  `${port ? `http://localhost:${port}` : ''}${_path.replace(`${path.resolve(process.cwd(), '.epk', 'dist')}\\\\`, '/tests/').replace('\\\\', '/')}`\r\n  \r\nexport const transformPathToEpkUrl = (_path, port) =>\r\n  `${port ? `http://localhost:${port}` : ''}${_path.replace(`${path.resolve(__dirname, '..', 'dist')}\\\\`, '/epk/').replace('\\\\', '/')}`\r\n","// from https://github.com/parcel-bundler/parcel/tree/master/packages/core/logger/src\r\n\r\nimport Chalk from 'Chalk'\r\nimport readline from 'readline'\r\nimport { countBreaks } from 'grapheme-breaker'\r\nimport stripAnsi from 'strip-ansi'\r\nimport ora from 'ora'\r\nimport path from 'path'\r\nimport fs from 'fs'\r\n\r\nconst prettyError = (err, { color } = { color: undefined }) => {\r\n  let message = typeof err === 'string' ? err : err.message\r\n  if (!message) message = 'Unknown error'\r\n\r\n  if (err.fileName) {\r\n    let fileName = err.fileName\r\n    if (err.loc) {\r\n      fileName += `:${err.loc.line}:${err.loc.column}`\r\n    }\r\n\r\n    message = `${fileName}: ${message}`\r\n  }\r\n\r\n  let stack\r\n  if (err.codeFrame) {\r\n    stack = (color && err.highlightedCodeFrame) || err.codeFrame\r\n  } else if (err.stack) {\r\n    stack = err.stack.slice(err.stack.indexOf('\\n') + 1)\r\n  }\r\n\r\n  return {\r\n    message, stack\r\n  }\r\n}\r\n\r\nconst supportsEmoji =\r\n  process.platform !== 'win32' || process.env.TERM === 'xterm-256color'\r\n\r\n// Fallback symbols for Windows from https://en.wikipedia.org/wiki/Code_page_437\r\nconst defaultEmojis = {\r\n  progress: supportsEmoji ? '⏳' : '∞',\r\n  success: supportsEmoji ? '✨' : '√',\r\n  error: supportsEmoji ? '🚨' : '×',\r\n  warning: supportsEmoji ? '⚠️' : '‼'\r\n}\r\n\r\nconst countLines = str =>\r\n  stripAnsi(str)\r\n    .split('\\n')\r\n    .reduce((p, line) =>\r\n      process.stdout.columns\r\n        ? p + Math.ceil((line.length || 1) / process.stdout.columns)\r\n        : p + 1, 0)\r\n\r\n// Pad a string with spaces on either side\r\nconst pad = (text, length, align = 'left') => {\r\n  const pad = ' '.repeat(length - stringWidth(text))\r\n  if (align === 'right') return `${pad}${text}`\r\n  return `${text}${pad}`\r\n}\r\n\r\n// Count visible characters in a string\r\nconst stringWidth = str =>\r\n  // @ts-ignore\r\n  `${str}`\r\n  // @ts-ignore\r\n  |> stripAnsi\r\n  // @ts-ignore\r\n  |> countBreaks\r\n\r\nconst Logger = ({\r\n  logLevel = 3,\r\n  color = Chalk.supportsColor,\r\n  emojis = defaultEmojis,\r\n  chalk = new Chalk.constructor({ enabled: color }),\r\n  isTest = process.env.NODE_ENV === 'test'\r\n} = {}) => {\r\n  let lines = 0\r\n  let spinner\r\n  let logFile\r\n\r\n  const writeRaw = str => {\r\n    stopSpinner()\r\n    lines += countLines(str) - 1\r\n    process.stdout.write(str)\r\n  }\r\n\r\n  const write = (message, persistent = false) => {\r\n    if (logLevel > 3) {\r\n      return verbose(message)\r\n    }\r\n\r\n    if (!persistent) {\r\n      lines += countLines(message)\r\n    }\r\n\r\n    stopSpinner()\r\n    _log(message)\r\n  }\r\n\r\n  const verbose = str => {\r\n    if (logLevel < 4) return\r\n    let currDate = new Date()\r\n    str = `[${currDate.toLocaleTimeString()}]: ${str}`\r\n    if (logLevel > 4) {\r\n      if (!logFile) {\r\n        logFile = fs.createWriteStream(\r\n          path.join(process.cwd(), `parcel-debug-${currDate.toISOString()}.log`)\r\n        )\r\n      }\r\n      logFile.write(stripAnsi(str) + '\\n')\r\n    }\r\n    _log(str)\r\n  }\r\n\r\n  const log = str =>\r\n    logLevel >= 3 &&\r\n    write(str)\r\n\r\n  const persistent = str =>\r\n    logLevel >= 3 &&\r\n    write(chalk.bold(str), true)\r\n\r\n  const warn = err =>\r\n    logLevel >= 2 &&\r\n    _writeError(err, emojis.warning, chalk.yellow)\r\n\r\n  const error = err =>\r\n    logLevel >= 1 &&\r\n    _writeError(err, emojis.error, chalk.red.bold)\r\n\r\n  const success = str =>\r\n    log(`${emojis.success}  ${chalk.green.bold(str)}`)\r\n\r\n  const formatError = (err, options) => prettyError(err, options)\r\n\r\n  const _writeError = (err, emoji, _color) => {\r\n    const { message, stack } = formatError(err, { color })\r\n    write(_color(`${emoji}  ${message}`))\r\n    if (stack) write(stack)\r\n  }\r\n\r\n  const clear = () => {\r\n    if (!color || isTest || logLevel > 3) return\r\n\r\n    while (lines > 0) {\r\n      readline.clearLine(process.stdout, 0)\r\n      readline.moveCursor(process.stdout, 0, -1)\r\n      lines--\r\n    }\r\n\r\n    readline.cursorTo(process.stdout, 0)\r\n    stopSpinner()\r\n  }\r\n\r\n  const progress = str => {\r\n    if (logLevel < 3) return\r\n    else if (logLevel > 3) return verbose(str)\r\n\r\n    const styledMessage = chalk.gray.bold(str)\r\n    if (!spinner) {\r\n      spinner = ora({\r\n        text: styledMessage,\r\n        stream: process.stdout,\r\n        enabled: isTest ? false : undefined // fall back to ora default unless we need to explicitly disable it.\r\n      }).start()\r\n    } else spinner.text = styledMessage\r\n  }\r\n\r\n  const stopSpinner = () => {\r\n    if (spinner) {\r\n      spinner.stop()\r\n      spinner = null\r\n    }\r\n  }\r\n\r\n  const _log = str => console.log(str)\r\n\r\n  const table = (columns, table) => {\r\n    // Measure column widths\r\n    let colWidths = []\r\n    for (let row of table) {\r\n      let i = 0\r\n      for (let item of row) {\r\n        colWidths[i] = Math.max(colWidths[i] || 0, stringWidth(item))\r\n        i++\r\n      }\r\n    }\r\n\r\n    // Render rows\r\n    for (let row of table) {\r\n      log(\r\n        row.map((item, i) => {\r\n          // Add padding between columns unless the alignment is the opposite to the\r\n          // next column and pad to the column width.\r\n          let padding =\r\n            !columns[i + 1] || columns[i + 1].align === columns[i].align ? 4 : 0\r\n          return pad(item, colWidths[i] + padding, columns[i].align)\r\n        })\r\n        .join('')\r\n      )\r\n    }\r\n  }\r\n\r\n  const logger = {\r\n    writeRaw,\r\n    write,\r\n    verbose,\r\n    log,\r\n    persistent,\r\n    warn,\r\n    error,\r\n    success,\r\n    formatError,\r\n    _writeError,\r\n    clear,\r\n    progress,\r\n    stopSpinner,\r\n    _log,\r\n    table,\r\n    handleMessage: undefined,\r\n  }\r\n\r\n  const handleMessage = ({ method, args }) => logger[method](...args)\r\n  logger.handleMessage = handleMessage\r\n\r\n  return logger\r\n}\r\n\r\nexport default Logger()\r\n","// https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/utils/installPackage.js\r\n\r\nimport config from 'parcel-bundler/src/utils/config'\r\nimport commandExists from 'command-exists'\r\nimport logger from '../cli/logger'\r\nimport pipeSpawn from 'parcel-bundler/src/utils/pipeSpawn'\r\nimport PromiseQueue from 'parcel-bundler/src/utils/PromiseQueue'\r\nimport path from 'path'\r\nimport fs from '@parcel/fs'\r\nimport WorkerFarm from '@parcel/workers'\r\nimport utils from '@parcel/utils'\r\nimport _resolve from 'resolve'\r\n\r\nconst { promisify } = utils\r\nconst resolve  = promisify(_resolve)\r\n\r\nconst YARN_LOCK = 'yarn.lock'\r\n\r\nasync function install(modules, filepath, options = { installPeers: true, saveDev: true, packageManager: undefined }) {\r\n  let { installPeers = true, saveDev = true, packageManager } = options\r\n  if (typeof modules === 'string') {\r\n    modules = [modules]\r\n  }\r\n\r\n  logger.progress(`Installing ${modules.join(', ')}...`)\r\n\r\n  let packageLocation = await config.resolve(filepath, ['package.json'])\r\n  let cwd = packageLocation ? path.dirname(packageLocation) : process.cwd()\r\n\r\n  if (!packageManager) {\r\n    packageManager = await determinePackageManager(filepath)\r\n  }\r\n\r\n  let commandToUse = packageManager === 'npm' ? 'install' : 'add'\r\n  let args = [commandToUse, ...modules]\r\n  if (saveDev) {\r\n    args.push('-D')\r\n  } else if (packageManager === 'npm') {\r\n    args.push('--save')\r\n  }\r\n\r\n  // npm doesn't auto-create a package.json when installing,\r\n  // so create an empty one if needed.\r\n  if (packageManager === 'npm' && !packageLocation) {\r\n    await fs.writeFile(path.join(cwd, 'package.json'), '{}')\r\n  }\r\n\r\n  try {\r\n    await pipeSpawn(packageManager, args, {cwd})\r\n  } catch (err) {\r\n    throw new Error(`Failed to install ${modules.join(', ')}.`)\r\n  }\r\n\r\n  if (installPeers) {\r\n    await Promise.all(\r\n      modules.map(m => installPeerDependencies(filepath, m, options))\r\n    )\r\n  }\r\n}\r\n\r\nasync function installPeerDependencies(filepath, name, options) {\r\n  let basedir = path.dirname(filepath)\r\n  const [resolved] = await resolve(name, {basedir})\r\n  const pkg = await config.load(resolved, ['package.json'])\r\n  const peers = pkg.peerDependencies || {}\r\n\r\n  const modules = []\r\n  for (const peer in peers) {\r\n    modules.push(`${peer}@${peers[peer]}`)\r\n  }\r\n\r\n  if (modules.length) {\r\n    await install(\r\n      modules,\r\n      filepath,\r\n      Object.assign({}, options, {installPeers: false})\r\n    )\r\n  }\r\n}\r\n\r\nasync function determinePackageManager(filepath) {\r\n  const yarnLockFile = await config.resolve(filepath, [YARN_LOCK])\r\n\r\n  /**\r\n   * no yarn.lock => use npm\r\n   * yarn.lock => Use yarn, fallback to npm\r\n   */\r\n  if (!yarnLockFile) {\r\n    return 'npm'\r\n  }\r\n\r\n  const hasYarn = await checkForYarnCommand()\r\n  if (hasYarn) {\r\n    return 'yarn'\r\n  }\r\n\r\n  return 'npm'\r\n}\r\n\r\nlet hasYarn = null\r\nasync function checkForYarnCommand() {\r\n  if (hasYarn != null) {\r\n    return hasYarn\r\n  }\r\n\r\n  try {\r\n    hasYarn = await commandExists('yarn')\r\n  } catch (err) {\r\n    hasYarn = false\r\n  }\r\n\r\n  return hasYarn\r\n}\r\n\r\nlet queue = new PromiseQueue(install, {maxConcurrent: 1, retry: false})\r\nexport default async function(...args) {\r\n  // Ensure that this function is always called on the master process so we\r\n  // don't call multiple installs in parallel.\r\n  if (WorkerFarm.isWorker()) {\r\n    await WorkerFarm.callMaster({\r\n      location: __filename,\r\n      args\r\n    })\r\n    return\r\n  }\r\n\r\n  queue.add(...args)\r\n  return queue.run()\r\n}\r\n\r\n// export default async (...names) => {\r\n//   await _installPackage(names)\r\n//   return names.length === 1\r\n//           ? import(name)\r\n//           : Promise.all(names.map(name => import(name)))\r\n// }","// https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/utils/getModuleParts.js\r\nimport path from 'path'\r\n\r\nexport default function(name) {\r\n  let parts = path.normalize(name).split(path.sep)\r\n  if (parts[0].charAt(0) === '@') {\r\n    // Scoped module (e.g. @scope/module). Merge the first two parts back together.\r\n    parts.splice(0, 2, `${parts[0]}/${parts[1]}`)\r\n  }\r\n\r\n  return parts\r\n}","// https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/utils/localRequire.js\r\nimport { dirname } from 'path'\r\nimport utils from '@parcel/utils'\r\nimport Resolve from 'resolve'\r\nimport installPackage from './installPackage'\r\nimport getModuleParts from './getModuleParts'\r\n\r\nconst { promisify } = utils\r\nconst _resolve = promisify(Resolve)\r\n\r\nconst cache = new Map();\r\n\r\nexport const localRequire = async (name, path, triedInstall = false) => {\r\n  const [resolved] = await resolve(name, path, triedInstall)\r\n  return require(resolved)\r\n}\r\n\r\nexport const resolve = async (name, path, triedInstall = false) => {\r\n  let basedir = dirname(path)\r\n  let key = basedir + ':' + name\r\n  let resolved = cache.get(key)\r\n  if (!resolved) {\r\n    try {\r\n      resolved = await _resolve(name, {basedir})\r\n    } catch (e) {\r\n      if (e.code === 'MODULE_NOT_FOUND' && !triedInstall) {\r\n        const packageName = getModuleParts(name)[0]\r\n        await installPackage(packageName, path)\r\n        return resolve(name, path, true)\r\n      }\r\n      throw e\r\n    }\r\n    cache.set(key, resolved)\r\n  }\r\n  return resolved\r\n}\r\n\r\nexport default async (packages, path = __filename) =>\r\n  typeof packages === 'string'\r\n    ? localRequire(packages, path)\r\n    : Promise.all(packages.map(pkg => localRequire(pkg, path)))\r\n","import path from 'path'\r\nimport { Observable } from 'rxjs'\r\nimport localRequire from '../utils/localRequire'\r\nimport { TargetRuntimeObservable } from '../types'\r\nimport { transformPathToEpkUrl } from '../utils'\r\n\r\nlet pptr\r\n\r\nexport default (options): TargetRuntimeObservable =>\r\n  Observable.create(observer => {\r\n    if (!pptr) pptr = localRequire('puppeteer', __filename)\r\n\r\n    let closed\r\n    const browser = pptr.then(pptr => pptr.launch({ devtools: true }))\r\n\r\n    browser.then(browser => {\r\n      if (closed) return\r\n      observer.next(Observable.create(observer => {\r\n        const page = browser.newPage()\r\n        const a = path.resolve(__dirname, '..', 'dist', 'empty.html')\r\n        const _path = transformPathToEpkUrl(path.resolve(__dirname, '..', 'dist', 'empty.html'), options.port)\r\n        page.then(page => {\r\n          observer.next({\r\n            loadFile: file => page.goto(transformPathToEpkUrl(path.resolve(process.cwd(), 'dist/empty.html'), options.port)).then(() => page.addScriptTag({ url: file.url })),\r\n            exec: str => page.evaluate(str)\r\n          })\r\n        })\r\n        return () => page.then(page => page.close())\r\n      }))\r\n    })\r\n\r\n    return () => {\r\n      closed = true\r\n      browser.then(browser => browser.close())\r\n    }\r\n  })\r\n","import { TARGET, TargetRuntimeProviderOptions, TargetRuntimeProvider, TargetRuntimeObservable } from '../types'\r\nimport ChromeRuntime from '../targets/chrome'\r\nimport { map } from 'rxjs/operators'\r\n// import FirefoxRuntime from '../targets/firefox'\r\n\r\nconst targetRuntimes = new Map([\r\n  [TARGET.CHROME, ChromeRuntime],\r\n  // [TARGET.FIREFOX, FirefoxRuntime]\r\n])\r\n\r\nexport default\r\n  (target: TARGET, options: TargetRuntimeProviderOptions): TargetRuntimeProvider => {\r\n    const targetRuntimeProvider = targetRuntimes.get(target)(options)\r\n    targetRuntimeProvider.target = target\r\n    targetRuntimeProvider.options = options\r\n    // @ts-ignore\r\n    return targetRuntimeProvider\r\n      // @ts-ignore\r\n      |> map((targetRuntime: TargetRuntimeObservable) => {\r\n        targetRuntime.target = target\r\n        targetRuntime.options = options\r\n        return targetRuntime\r\n      })\r\n  }\r\n","\r\nexport const stringify = (strings, ...vals) =>\r\n  strings.reduce((finalStr, str, i) =>\r\n    `${finalStr}${str}${vals.length > i ? JSON.stringify(vals[i]) : ''}`, '')\r\n\r\nexport const prettifyTime = time =>\r\n  time < 1000\r\n    ? `${time.toFixed()}ms`\r\n    : `${(time / 1000).toFixed(2)}s`\r\n\r\nexport const isBrowser = typeof window !== 'undefined'\r\n","import { switchMap, map, mergeMap, take, delay } from 'rxjs/operators'\r\nimport { TargetRuntime, BUNDLER_TARGET, NODE_GLOBAL, MESSAGE_TYPE, File, FileType } from '../types'\r\nimport { stringify } from './utils'\r\n\r\nconst browserStr = data => stringify`\r\nnew Promise(resolve => {\r\n  window.addEventListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.GET_TESTS_RESPONSE}\r\n    && resolve(data))\r\n  window.postMessage(${data}, '*')\r\n})\r\n`\r\n\r\nconst nodeStr = data => stringify`\r\nnew Promise(resolve => {\r\n  global[${NODE_GLOBAL}].addListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.GET_TESTS_RESPONSE}\r\n    && resolve(data))\r\n  global[${NODE_GLOBAL}].emit('message', ${data})\r\n})\r\n`\r\n\r\nconst analyzeStr = (options, data) =>\r\n  options.target === BUNDLER_TARGET.BROWSER\r\n    ? browserStr(data)\r\n    : nodeStr(data)\r\n\r\nexport default\r\n  (targetRuntimeProvider, options) =>\r\n    // @ts-ignore\r\n    switchMap((file: File) =>\r\n      // @ts-ignore\r\n      targetRuntimeProvider\r\n      // @ts-ignore\r\n      |> mergeMap(async (targetRuntime: TargetRuntime) => {\r\n        await targetRuntime.loadFile(file)\r\n        const { data: tests, errors } = await targetRuntime.exec(analyzeStr(options, { type: MESSAGE_TYPE.GET_TESTS }))\r\n        return {\r\n          type: FileType.ANALYZE,\r\n          ...file,\r\n          tests,\r\n          errors\r\n        }\r\n      })\r\n      // @ts-ignore\r\n      |> take(1))\r\n","import { switchMap, mergeMap, take } from 'rxjs/operators'\r\nimport { TargetRuntime, BUNDLER_TARGET, NODE_GLOBAL, MESSAGE_TYPE, FileType } from '../types'\r\nimport { stringify } from './utils'\r\n\r\nconst browserStr = data => stringify`\r\nnew Promise(resolve => {\r\n  window.addEventListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.RUN_TEST_RESPONSE}\r\n    && resolve(data))\r\n  window.postMessage(${data}, '*')\r\n})\r\n`\r\n\r\nconst nodeStr = data => stringify`\r\nnew Promise(resolve => {\r\n  global[${NODE_GLOBAL}].addListener('message', ({ data }) =>\r\n    data.type === ${MESSAGE_TYPE.RUN_TEST_RESPONSE}\r\n    && resolve(data))\r\n  global[${NODE_GLOBAL}].emit('message', ${data})\r\n})\r\n`\r\n\r\nconst testStr = (options, data) =>\r\n  options.target === BUNDLER_TARGET.BROWSER\r\n    ? browserStr(data)\r\n    : nodeStr(data)\r\n\r\nexport default\r\n  (file, targetRuntimeProvider, options) =>\r\n    mergeMap(test =>\r\n      // @ts-ignore\r\n      targetRuntimeProvider\r\n      // @ts-ignore\r\n      |> mergeMap(async (targetRuntime: TargetRuntime) => {\r\n        await targetRuntime.loadFile(file)\r\n        const { data: result } = await targetRuntime.exec(testStr(options, { type: MESSAGE_TYPE.RUN_TEST, description: test.description }))\r\n        return {\r\n          ...file,\r\n          type: FileType.TEST,\r\n          test: {\r\n            ...test,\r\n            ...result\r\n          }\r\n        }\r\n      })\r\n      // @ts-ignore\r\n      |> take(1))\r\n","import path from 'path'\r\nimport { Observable } from 'rxjs'\r\nimport { switchMap } from 'rxjs/operators'\r\nimport localRequire from '../utils/localRequire'\r\n\r\nlet imports\r\n\r\nexport default options =>\r\n  switchMap(val =>\r\n    Observable.create(observer => {\r\n      const { port } = options\r\n      if (!imports) imports = localRequire(['koa', 'koa-static', 'koa-mount'], __filename)\r\n\r\n      const app = imports.then(([Koa, serve, mount]) => {\r\n        const app = new Koa()\r\n        const epk = new Koa()\r\n        epk.use(serve(path.resolve(__dirname, '..', 'dist')))\r\n        const tests = new Koa()\r\n        tests.use(serve(path.resolve(process.cwd(), '.epk', 'dist')))\r\n        \r\n        app.use(mount('/epk', epk))\r\n        app.use(mount('/tests', tests))\r\n        try {\r\n          return app.listen(port)\r\n        } finally {\r\n          observer.next(val)\r\n        }\r\n      })\r\n\r\n      return _ => app.then(app => app.close())\r\n    })\r\n  )\r\n","import { merge, ConnectableObservable, from, of, zip, Observable } from 'rxjs'\r\nimport { map, filter, mergeMap, switchMap, publish, tap, delayWhen } from 'rxjs/operators'\r\n\r\nimport { Options, Context, BUNDLER_TARGET, TARGET, File, TargetRuntimeProvider as TargetRuntimeProviderType } from '../types'\r\nimport Bundler from './bundler'\r\nimport { transformPathToTestUrl } from '../utils/index'\r\nimport TargetRuntimeProvider from './target-runtime-provider'\r\nimport analyze from './analyze'\r\nimport test from './test'\r\nimport { isBrowser } from './utils'\r\nimport server from './server'\r\nimport localRequire from '../utils/localRequire'\r\n\r\n\r\nexport default (_options: Options) => {\r\n  // remove undefined values\r\n  Object.keys(_options).forEach(key => _options[key] === undefined && delete _options[key])\r\n\r\n  const target = _options.target || BUNDLER_TARGET.BROWSER\r\n  const options = {\r\n    browsers: ['chrome'],\r\n    target,\r\n    outDir: `.epk/dist/${target}`,\r\n    watch: true,\r\n    cache: true,\r\n    cacheDir: `.epk/cache/${target}`,\r\n    port: undefined,\r\n    minify: false,\r\n    scopeHoist: false,\r\n    logLevel: 0, // 3 = log everything, 2 = log warnings & errors, 1 = log errors\r\n    sourceMaps: true, // Enable or disable sourcemaps, defaults to enabled (minified builds currently always create sourcemaps)\r\n    detailedReport: false,\r\n    // apply options\r\n    ..._options\r\n  }\r\n  let _port\r\n  if (!isBrowser && options.target === BUNDLER_TARGET.BROWSER) {\r\n    _port = localRequire('get-port', __filename)\r\n              .then(getPort => getPort({ port: 10485 }))\r\n              .then(port => (options.port = port))\r\n  }\r\n  // @ts-ignore\r\n  return of([\r\n            Bundler(options),\r\n            (!isBrowser && options.target === BUNDLER_TARGET.BROWSER\r\n              ? options.browsers as unknown as TARGET[]\r\n              : [options.target] as unknown as TARGET[])\r\n                .map(target => TargetRuntimeProvider(target, options))\r\n          ])\r\n          // @ts-ignore\r\n          |> (!isBrowser && options.target === BUNDLER_TARGET.BROWSER ? delayWhen(() => from(_port)) : tap())\r\n          // @ts-ignore\r\n          |> (!isBrowser && options.target === BUNDLER_TARGET.BROWSER ? server(options) : tap())\r\n          // @ts-ignore\r\n          |> mergeMap(([ bundler, targetRuntimeProviders ]) =>\r\n            merge(\r\n              // @ts-ignore\r\n              bundler\r\n              // @ts-ignore\r\n              |> filter(({ name }) => name === 'buildStart'),\r\n              // @ts-ignore\r\n              bundler\r\n              // @ts-ignore\r\n              |> filter(({ name }) => name === 'buildStart')\r\n              // @ts-ignore\r\n              |> switchMap(({ entryFiles, buildStartTime }) =>\r\n                // @ts-ignore\r\n                bundler\r\n                // @ts-ignore\r\n                |> filter(({ name }) => name === 'bundled')\r\n                // @ts-ignore\r\n                |> map(bundleContainer => ({\r\n                  ...bundleContainer,\r\n                  entryFiles,\r\n                  buildStartTime\r\n                })))\r\n              // @ts-ignore\r\n              |> switchMap(({ bundle }) =>\r\n                // @ts-ignore\r\n                merge(...targetRuntimeProviders)\r\n                // @ts-ignore\r\n                |> mergeMap((targetRuntimeProvider: TargetRuntimeProviderType) =>\r\n                  // @ts-ignore\r\n                  from(\r\n                    (bundle.isEmpty\r\n                      ? Array.from(bundle.childBundles)\r\n                      : [bundle])\r\n                        .map(({ name: path }) => path))\r\n                    // @ts-ignore\r\n                    |> mergeMap(path => {\r\n                      // @ts-ignore\r\n                      const newContextObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        of({\r\n                          target: targetRuntimeProvider.target,\r\n                          name: bundle.entryAsset.name,\r\n                          path,\r\n                          url: options.target === BUNDLER_TARGET.BROWSER && transformPathToTestUrl(path, options.port)\r\n                        })\r\n                        // @ts-ignore\r\n                        |> publish()\r\n\r\n                      // @ts-ignore\r\n                      const analyzedObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        newContextObservable\r\n                        // @ts-ignore\r\n                        |> analyze(targetRuntimeProvider, options)\r\n                        // @ts-ignore\r\n                        |> publish()\r\n          \r\n                      // @ts-ignore\r\n                      const testedObservable: ConnectableObservable<File> =\r\n                        // @ts-ignore\r\n                        analyzedObservable\r\n                        // @ts-ignore\r\n                        |> filter(file => !file.errors.length)\r\n                        // @ts-ignore\r\n                        |> switchMap(file =>\r\n                          // @ts-ignore\r\n                          from(file.tests)\r\n                          // @ts-ignore\r\n                          |> test(file, targetRuntimeProvider, options))\r\n                        // @ts-ignore\r\n                        |> publish()\r\n          \r\n                      const testerObservable =\r\n                        merge(\r\n                          newContextObservable,\r\n                          analyzedObservable,\r\n                          testedObservable\r\n                        )\r\n          \r\n                      testedObservable.connect()\r\n                      analyzedObservable.connect()\r\n                      newContextObservable.connect()\r\n          \r\n                      return testerObservable\r\n                    })\r\n                ))\r\n            ))\r\n}\r\n","import { isBrowser } from '../core/utils'\r\n\r\nexport const errors = []\r\n\r\nif (isBrowser) {\r\n  window.addEventListener('error', err => errors.push(err))\r\n} else {\r\n  process.on('uncaughtException', err => errors.push(err))\r\n}\r\n\r\n","import { EventEmitter } from 'events'\r\nimport { stringify } from 'flatted/cjs'\r\nimport { isBrowser } from '../core/utils'\r\nimport { File, Test, TestResult, MESSAGE_TYPE, NODE_GLOBAL } from '../types'\r\nimport { errors } from './error'\r\nimport { isObservable } from 'rxjs';\r\n\r\nexport const tests = new Map<string, Function>()\r\n\r\nexport const todo = _ => {}\r\nexport const pass = _ => {}\r\nexport const fail = _ => {}\r\n\r\nexport const test = (desc, func) => {\r\n  if (typeof desc !== 'string') throw new Error('desc has to be a string')\r\n  if (typeof func !== 'function') throw new Error('func has to be a function')\r\n  if (tests.has(desc)) throw new Error(`Found duplicate test description: ${desc}`)\r\n  tests.set(desc, func)\r\n}\r\n\r\nconst initiated = new Promise(resolve => setTimeout(resolve, 0))\r\n\r\nconst emit = (type, data) =>\r\n  isBrowser\r\n    ? window.parent.postMessage({ type, errors, data }, '*')\r\n    : global[NODE_GLOBAL].emit('message', { type, errors, data })\r\n\r\nconst getTests = () =>\r\n  emit(\r\n    MESSAGE_TYPE.GET_TESTS_RESPONSE,\r\n    Array\r\n      .from(tests)\r\n      .map(([description, func]) => ({\r\n        description,\r\n        body: func.toString()\r\n      }))\r\n  )\r\n\r\nconst runTest = async description => {\r\n  // todo: replace by \"isBrowser ? window : require('perf_hooks')\"\r\n  const { performance } = window\r\n  let timeStart, timeEnd, value, error\r\n\r\n  try {\r\n    timeStart = performance.now()\r\n    value = await tests.get(description)()\r\n  } catch (err) {\r\n    error = err\r\n  } finally {\r\n    timeEnd = performance.now()\r\n  }\r\n  \r\n  emit(\r\n    MESSAGE_TYPE.RUN_TEST_RESPONSE,\r\n    {\r\n      timeStart,\r\n      timeEnd,\r\n      type:\r\n        isObservable(value) ? 'observable'\r\n        : value instanceof Promise ? 'promise'\r\n        : 'function',\r\n      value: stringify(value),\r\n      error: error && {\r\n        name: error.name,\r\n        message: error.message\r\n      }\r\n    }\r\n  )\r\n}\r\n\r\nconst newEvent = ({ data: { type, description } }) =>\r\n    type === MESSAGE_TYPE.GET_TESTS ? getTests()\r\n  : type === MESSAGE_TYPE.RUN_TEST && runTest(description)\r\n\r\nif (isBrowser) {\r\n  window.addEventListener('message', newEvent)\r\n} else {\r\n  const events = global[NODE_GLOBAL] = new EventEmitter()\r\n  events.addListener('message', newEvent)\r\n}\r\n\r\n// const addEventListener =\r\n//   isBrowser\r\n//     ? window.addEventListener\r\n//     : global[NODE_GLOBAL].addListener\r\n\r\n// addEventListener('message', ({ data: { type, description } }) =>\r\n//     type === MESSAGE_TYPE.GET_TESTS ? getTests()\r\n//   : type === MESSAGE_TYPE.RUN_TEST && runTest(description))\r\n","import PowerAssert from 'power-assert'\r\n\r\nexport const assert = PowerAssert.customize({\r\n\r\n})","// export * from './test'\r\n// export * from './assert'\r\n\r\n// parceljs experimental hoisting fix\r\nimport { test } from './test'\r\nimport { assert } from './assert'\r\n\r\nexport {\r\n  test,\r\n  assert\r\n}","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","export * from './core/index'\r\nexport * from './test/index'\r\n\r\nif (!module.parent) import('./cli/index').then(() => {}) // keep the then because else, the code isn't executed\r\n"]}